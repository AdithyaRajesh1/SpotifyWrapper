{% extends "base.html" %}

{% block title %}Your Spotify Wrapped{% endblock %}

{% block content %}
    <head>
        <style>
            .share-section {
                margin: 2rem 0;
                padding: 1.5rem;
                background: #f8f9fa;
                border-radius: 8px;
            }
            
            .share-buttons {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
                margin-top: 1rem;
            }
            
            .share-button {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 25px;
                color: white;
                font-weight: 600;
                text-decoration: none;
                cursor: pointer;
                transition: opacity 0.2s;
            }
            
            .share-button:hover {
                opacity: 0.9;
            }
            
            .share-icon {
                width: 1.25rem;
                height: 1.25rem;
                fill: currentColor;
            }
            
            .twitter {
                background-color: #1DA1F2;
            }
            
            .linkedin {
                background-color: #0077B5;
            }
            
            .instagram {
                background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
            }
        </style>
    </head>
    <h1>Your Spotify Wrapped</h1>
    <section class="share-section">
        <h2>Share Your Wrapped</h2>
        <div class="share-buttons">
            <!-- Twitter Share Button -->
            <a href="{{ wrapped_data.sharing.twitter.url }}" 
               target="_blank" 
               class="share-button twitter"
               title="Share on Twitter">
                <svg class="share-icon" viewBox="0 0 24 24">
                    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                </svg>
                Share on X
            </a>
    
            <!-- LinkedIn Share Button -->
            <a href="{{ wrapped_data.sharing.linkedin.url }}"
               target="_blank"
               class="share-button linkedin"
               title="Share on LinkedIn">
                <svg class="share-icon" viewBox="0 0 24 24">
                    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                    <rect x="2" y="9" width="4" height="12"></rect>
                    <circle cx="4" cy="4" r="2"></circle>
                </svg>
                Share on LinkedIn
            </a>
    
            <!-- Instagram Share Button -->
            <button onclick="copyInstagramText()" 
                    class="share-button instagram"
                    title="Copy text for Instagram">
                <svg class="share-icon" viewBox="0 0 24 24">
                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                    <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                </svg>
                Copy for Instagram
            </button>
        </div>
    </section>

    <!-- Rest of your existing code remains the same -->
    <!-- Total Counts Section -->
    <section>
        <h2>Stats Overview</h2>
        <!-- ... rest of your existing code ... -->
    </section>
    <section>
        <h2>Stats Overview</h2>
        <div class="time-range-selector">
            <form method="get" action="">
                <select name="time_range" onchange="this.form.submit()">
                    {% for range in wrapped_data.availableTimeRanges %}
                        <option value="{{ range.value }}" {% if range.value == wrapped_data.currentTimeRange %}selected{% endif %}>
                            {{ range.display }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>
        <ul>
            <li>
                <strong>Total Artists:</strong> {{ wrapped_data.totalArtists }}
            </li>
            <li>
                <strong>Total Tracks:</strong> {{ wrapped_data.totalTracks }}
            </li>
            <li>
                <strong>Total Albums:</strong> {{ wrapped_data.totalAlbums }}
            </li>
            <li>
                <strong>Total Listening Time:</strong> {{ wrapped_data.listeningTimeHours }} hours
            </li>
            <li>
                <strong>New Artists Discovered:</strong> {{ wrapped_data.newArtistsCount }}
            </li>
            <li>
                <strong>Available In:</strong> {{ wrapped_data.totalLocations }} countries
            </li>
        </ul>
    </section>

    <!-- Top Artists Section -->
    <section>
        <h2>Top Artists</h2>
        <ul>
            {% for artist in wrapped_data.topArtists %}
                <li>
                    {% if artist.image %}
                        <img src="{{ artist.image }}" alt="{{ artist.name }}" width="50" height="50">
                    {% endif %}
                    <strong>{{ artist.name }}</strong>
                    {% if artist.genres %}
                        - Genres: {{ artist.genres|join:", " }}
                    {% endif %}
                    {% if artist.spotifyUrl %}
                        <a href="{{ artist.spotifyUrl }}" target="_blank">(Open in Spotify)</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </section>

    <!-- Top Tracks Section -->
    <section>
        <h2>Top Tracks</h2>
        <ul>
            {% for track in wrapped_data.topTracks %}
                <li>
                    {% if track.image %}
                        <img src="{{ track.image }}" alt="{{ track.name }}" width="50" height="50">
                    {% endif %}
                    <strong>{{ track.name }}</strong> 
                    by {{ track.subtitle }}
                    {% if track.spotifyUrl %}
                        <a href="{{ track.spotifyUrl }}" target="_blank">(Open in Spotify)</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </section>

    <!-- Top Albums Section -->
    <section>
        <h2>Top Albums</h2>
        <ul>
            {% for album in wrapped_data.topAlbums %}
                <li>
                    {% if album.image %}
                        <img src="{{ album.image }}" alt="{{ album.name }}" width="50" height="50">
                    {% endif %}
                    <strong>{{ album.name }}</strong> 
                    by {{ album.subtitle }}
                    {% if album.releaseDate %}
                        (Released: {{ album.releaseDate }})
                    {% endif %}
                    {% if album.spotifyUrl %}
                        <a href="{{ album.spotifyUrl }}" target="_blank">(Open in Spotify)</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </section>

    <!-- Top Genres Section -->
    <section>
        <h2>Top Genres</h2>
        <ul>
            {% for genre in wrapped_data.topGenres %}
                <li>{{ genre.name }} ({{ genre.count }} tracks)</li>
            {% endfor %}
        </ul>
    </section>

    <!-- Top Locations Section -->
    <section>
        <h2>Top Listening Locations</h2>
        <ul>
            {% for location in wrapped_data.topLocations %}
                <li>{{ location.name }} ({{ location.count }} tracks available)</li>
            {% endfor %}
        </ul>
    </section>

    <!-- User Profile Section -->
    {% if wrapped_data.userProfile %}
        <section>
            <h2>Your Profile</h2>
            <div>
                {% if wrapped_data.userProfile.image %}
                    <img src="{{ wrapped_data.userProfile.image }}" 
                         alt="{{ wrapped_data.userProfile.name }}" 
                         width="100" 
                         height="100">
                {% endif %}
                <p><strong>Name:</strong> {{ wrapped_data.userProfile.name }}</p>
                <p><strong>Country:</strong> {{ wrapped_data.userProfile.country }}</p>
                <p><strong>Followers:</strong> {{ wrapped_data.userProfile.followersCount }}</p>
                <p><strong>Account Type:</strong> {{ wrapped_data.userProfile.product|title }}</p>
            </div>
        </section>
    {% endif %}

    <!-- Additional Context Sections -->
    {% if music_trends %}
        <section>
            <h2>Music Trends</h2>
            <p>{{ music_trends }}</p>
        </section>
    {% endif %}

    {% if sound_town %}
        <section>
            <h2>Your Sound Town</h2>
            <p>{{ sound_town }}</p>
        </section>
    {% endif %}

    {% if listening_character %}
        <section>
            <h2>Your Listening Character</h2>
            <p>{{ listening_character }}</p>
        </section>
    {% endif %}

{% endblock %}
{% block scripts %}
    <script>
        function copyInstagramText() {
            const text = {{ wrapped_data.sharing.instagram.text|escapejs }};
            navigator.clipboard.writeText(text).then(() => {
                alert('Text copied! You can now paste it in Instagram.');
            }).catch(err => {
                console.error('Failed to copy text:', err);
                alert('Failed to copy text. Please try again.');
            });
        }
    </script>
{% endblock %}